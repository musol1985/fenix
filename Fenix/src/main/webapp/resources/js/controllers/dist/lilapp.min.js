materialAdmin.controller("tablaCentros",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){b.datos=[],b.centro={id:"-1"},b.cargarDatos=function(){j.getAll().then(function(a){console.log("Cargando centros..."),b.datos=a.data,"-1"!=b.centro.id&&angular.forEach(b.datos,function(a){b.centro.id==a.id&&b.seleccionarCentro(a)})},function(a){l.alertaGrowl("Error al obtener centros","danger")})},b.cargarDatos(),b.seleccionarCentro=function(c){b.centro&&(b.centro.seleccionado=!1),b.centro=c,c.seleccionado=!0,a.$broadcast("onSeleccionarCentro",c)},b.modal={nuevoCentro:{centro:{correoAdmin:"",nombre:"",ubicacion:"",tipo:"0",color:"teal"},posicion:"",nombreAdmin:""},guardar:function(){l.procesar(j.nuevoCentro(b.modal.nuevoCentro),{0:{growl:!0,texto:"Centro creado. Se le ha enviado un email al usuario admin",tipo:"success",onProcesar:function(){b.refrescar()}},2:{titulo:"Atención",texto:"Ya existe un usuario registrado con ese correo",tipo:"warning"}}),b.modalInstance.close()},getUbicacion:function(a){return k.getUbicacion(a)},setUbicacion:function(a,b){var c=k.setUbicacion(a,b);this.nuevoCentro.centro.ubicacion=c.direccion,this.nuevoCentro.posicion=c.posicion},setColor:function(a){this.nuevoCentro.centro.color=a},getColores:function(){return["lightblue","bluegray","cyan","teal","green","orange","blue","purples"]}},b.refrescar=function(){b.cargarDatos()},b.refrescarUsuarios=function(){"-1"!=b.centro.id&&b.seleccionarCentro(b.centro)},b.nuevo=function(){b.modalInstance=m.mostrar(n,b.modal)}}),materialAdmin.controller("prestaciones",function(a,b,c,d,e,f,g,h){a.getDatos=function(a,b){e.getByCentro(c.getCentro().id,a.page(),a.count()).then(function(a){b(a.data,a.total)},function(a){f.alertaGrowl("Error al obtener prestaciones","danger")})},a.modal={data:{},getNew:function(){return{id:"",nombre:"",color:"",centro:c.getCentro().id}},mostrar:function(b){b&&(a.modal.data=this.getNew()),a.modalInstance=g.mostrar(h,a.modal,"resources/template/modals/prestacion.html")},guardar:function(){var b,c=a.modal.data;b=""==c.id?e.nueva(c):e.modificar(c),f.procesar(b,{0:{growl:!0,texto:"Prestación creada",tipo:"success",onProcesar:function(){a.refrescar()}},1:{titulo:"Atención",texto:"La prestación no existe",tipo:"warning"},2:{titulo:"Atención",texto:"Ya existe una prestación con ese nombre",tipo:"warning"},onError:function(){a.modal.mostrar(!1)}}),a.modalInstance.close()},setColor:function(a){this.data.color=a},getColores:function(){return["lightblue","bluegray","cyan","teal","green","orange","blue","purple"]}},a.refrescar=function(a){a.reload()},a.nuevo=function(){a.modal.mostrar(!0)},a.modificar=function(b){a.modal.data=angular.copy(b),a.modal.mostrar(!1)},a.eliminar=function(b){console.log(b),f.alertaSiNo("Eliminar","¿Seguro que quieres eliminar la prestación?",function(){f.procesar(e.eliminar(b.id),{0:{growl:!0,texto:"Prestación eliminada correctamente",tipo:"success",onProcesar:function(){a.refrescar()}},1:{titulo:"Atención",texto:"No existe la prestación",tipo:"warning"}})})}}),materialAdmin.controller("tablaUsuarios",function(a,b,c,d,e,f,g,h){var i=this;this.datos=[],a.todos=!1,a.centro="-1",this.tabla=new d({page:1,count:10},{getData:function(b,c){"-1"!=a.centro&&(a.todos?e.getAllByCentro(c.page(),c.count(),a.centro).then(function(a){i.datos=a.data,c.total(a.total),b.resolve(i.datos)},function(a){f.alertaGrowl("Error al obtener usuarios","danger")}):e.getByCentro(c.page(),c.count(),a.centro).then(function(a){i.datos=a.data,c.total(a.total),b.resolve(i.datos)},function(a){f.alertaGrowl("Error al obtener usuarios","danger")}))}}),a.setTodos=function(b){a.todos=b},a.setCentro=function(b){a.centro=b},a.setCentroSesion=function(){a.centro=e.current.centro.id},a.refrescar=function(){i.tabla.reload()},a.eliminar=function(b){console.log(b),f.alertaSiNo("Eliminar","¿Seguro que quieres eliminar el usuario?",function(){f.procesar(e.eliminar(b.id),{0:{growl:!0,texto:"Usuario eliminado correctamente",tipo:"success",onProcesar:function(){a.refrescar()}},1:{titulo:"Atención",texto:"No existe ese usuario",tipo:"warning"}})})},a.$on("onSeleccionarCentro",function(b,c){a.setCentro(c.id),i.tabla.reload()})}).controller("tablaUsuarioPendiente",function(a,b,c,d,e,f,g,h,i){var j=this;this.datos=[],this.tabla=new e({page:1,count:10},{getData:function(a,b){f.getPendientes(b.page(),b.count(),f.current.centro.id).then(function(c){j.datos=c.data,b.total(c.total),a.resolve(j.datos)},function(a){g.alertaGrowl("Error al obtener usuarios pendientes","danger")})}}),a.modal={usuario:{correo:"",nombre:"",color:""},guardar:function(){var b={centro:f.current.centro.id,usuario:a.modal.usuario};g.procesar(f.nuevoPendiente(b),{0:{growl:!0,texto:"Usuario pendiente creado. Se le ha enviado un email a su correo",tipo:"success",onProcesar:function(){var b=parseInt(j.tabla.total()/j.tabla.count())+1;j.tabla.page(b),a.refrescar()}},2:{titulo:"Atención",texto:"Ya existe un usuario con ese correo. Se le ha reenviado el codigo de activación a su correo.",tipo:"warning"},onError:function(){a.nuevo()}}),a.modalInstance.close()}},a.refrescar=function(){j.tabla.reload()},a.nuevo=function(){a.modalInstance=h.mostrar(i,a.modal)},a.eliminar=function(b){g.alertaSiNo("Eliminar","¿Seguro que quieres eliminar el usuario?",function(){g.procesar(f.eliminarPendiente(b.id),{0:{growl:!0,texto:"Usuario pendiente eliminado correctamente",tipo:"success",onProcesar:function(){a.refrescar()}},1:{titulo:"Atención",texto:"No existe un usuario pendiente con ese correo",tipo:"warning"}})})},a.enviarMail=function(b){g.procesar(f.enviarCorreo(b.id),{0:{growl:!0,texto:"Correo de activacion enviado a "+b.correo,tipo:"success",onProcesar:function(b){a.refrescar()}},1:{titulo:"Atención",texto:"No existe un usuario pendiente con ese correo",tipo:"warning"}})},a.$on("onSeleccionarColor",function(b,c){a.modal.usuario.color=c,console.log(a.modal.usuario)})});